<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FarmBot - Soil Data</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .dropdown-item {
      opacity: 0;
      animation: fadeSlideIn 0.4s ease forwards;
    }
    .dropdown-item:nth-child(1) { animation-delay: 0.1s; }
    .dropdown-item:nth-child(2) { animation-delay: 0.2s; }
    .dropdown-item:nth-child(3) { animation-delay: 0.3s; }
  </style>
</head>
<body class="bg-green-50 min-h-screen flex flex-col relative">

  <!-- Navbar -->
  <nav class="bg-green-700 text-white px-4 sm:px-6 py-4 flex justify-between items-center shadow-md">
    <h1 class="text-lg sm:text-xl md:text-2xl font-bold">ðŸšœ FarmBot</h1>
    <button id="menu-btn" class="md:hidden text-3xl focus:outline-none">â˜°</button>
    <!-- Desktop Menu -->
    <div id="menu" class="hidden md:flex flex-col gap-4 text-lg md:text-xl font-semibold">
      <a href="/" class="hover:text-yellow-300">Home</a>
      <a href="/control" class="hover:text-yellow-300">Controls</a>
      <a href="/moisture" class="hover:text-yellow-300 font-semibold">Moisture Data</a>
    </div>
  </nav>

<!-- Dropdown menu for mobile -->
<!-- Dropdown menu for mobile -->
<div id="dropdown" class="hidden bg-green-600 text-white text-lg md:hidden flex-col space-y-2 p-4">
  <a href="/" class="dropdown-item block w-full py-3 px-2 text-center bg-green-700 rounded-lg hover:bg-green-800">Home</a>
  <a href="/control" class="dropdown-item block w-full py-3 px-2 text-center bg-green-700 rounded-lg hover:bg-green-800">Controls</a>
  <a href="/moisture" class="dropdown-item block w-full py-3 px-2 text-center bg-green-700 rounded-lg hover:bg-green-800">Moisture Data</a>
</div>


  <!-- Date & Time -->
  <div id="dateTime" class="absolute top-24 sm:top-20 right-4 sm:right-6 text-gray-700 text-base sm:text-lg md:text-xl font-semibold"></div>

  <!-- Content -->
  <main class="flex flex-col items-center justify-center flex-grow px-4 py-6">
    <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold mb-6 text-green-800">ðŸŒ± Soil Moisture</h1>

    <!-- Circular Soil Moisture -->
    <div class="relative w-32 h-32 sm:w-40 sm:h-40 md:w-52 md:h-52 mb-6">
      <svg class="w-full h-full" viewBox="0 0 36 36">
        <path class="text-gray-200" stroke-width="3" stroke="currentColor" fill="none"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"/>
        <path id="moistureCircle" class="text-green-600 transition-all duration-500" stroke-width="3" stroke-dasharray="0,100"
          stroke="currentColor" fill="none"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"/>
      </svg>
      <div id="moistureDisplay"
        class="absolute inset-0 flex items-center justify-center text-xl sm:text-2xl md:text-3xl font-bold text-green-700">
        0%
      </div>
    </div>

    <!-- Graph -->
    <div class="w-full sm:w-4/5 md:w-2/3 lg:w-1/2 bg-white p-4 sm:p-6 rounded-2xl shadow-md h-80">
      <canvas id="moistureChart"></canvas>
    </div>
  </main>
    <footer class="bg-green-700 text-white text-center py-4 mt-auto">
    <p class="text-sm sm:text-base">
      Â© 2025 FarmBot | Designed by <span class="font-semibold text-yellow-300">Team Krishinova</span>
    </p>
  </footer>

  <script>
    // Chart setup
    const ctx = document.getElementById('moistureChart').getContext('2d');
    const moistureChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Soil Moisture (%)',
          data: [],
          borderColor: 'green',
          backgroundColor: 'rgba(34,197,94,0.2)',
          borderWidth: 2,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: true } },
        scales: { y: { beginAtZero: true, max: 100 } }
      }
    });

    // SSE connection
    const eventSource = new EventSource("/stream");
    eventSource.onmessage = (event) => {
      const moisture = parseInt(event.data);
      if (!isNaN(moisture)) {
        updateCircle(moisture);
        updateChart(moisture);
      }
    };

    // Update circle
    function updateCircle(value) {
      const circle = document.getElementById("moistureCircle");
      circle.setAttribute("stroke-dasharray", `${value}, 100`);
      document.getElementById("moistureDisplay").innerText = value + "%";
    }

    // Update graph
    function updateChart(value) {
      const now = new Date().toLocaleTimeString();
      if (moistureChart.data.labels.length > 10) {
        moistureChart.data.labels.shift();
        moistureChart.data.datasets[0].data.shift();
      }
      moistureChart.data.labels.push(now);
      moistureChart.data.datasets[0].data.push(value);
      moistureChart.update();
    }

    // Date & time updater
    function updateDateTime() {
      const now = new Date();
      document.getElementById("dateTime").innerText = now.toLocaleString();
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Mobile menu toggle with animation
    const btn = document.getElementById("menu-btn");
    const dropdown = document.getElementById("dropdown");
    btn.addEventListener("click", () => {
      dropdown.classList.toggle("hidden");
      if (!dropdown.classList.contains("hidden")) {
        const items = dropdown.querySelectorAll(".dropdown-item");
        items.forEach(item => {
          item.style.opacity = "0";
          item.style.animation = "none";
          void item.offsetWidth;
          item.style.animation = "";
        });
      }
    });
  </script>
</body>
</html>
